# システムフロー図

## 全体システムフロー

```mermaid
graph TD
    A[ユーザーアクセス] --> B{認証状態}
    B -->|未認証| C[ログイン画面]
    B -->|認証済み| D[ダッシュボード]
    
    C --> E[認証処理]
    E --> F{認証成功?}
    F -->|失敗| C
    F -->|成功| D
    
    D --> G[アンケート一覧]
    G --> H[新規作成]
    G --> I[既存アンケート編集]
    
    H --> J[アンケート作成フロー]
    I --> K[アンケート編集フロー]
    
    J --> L[公開・完了]
    K --> L
    
    L --> M[アンケート回答]
    M --> N[結果確認]
```

## アンケート作成・編集フロー

```mermaid
graph TD
    A[新規アンケート作成] --> B[基本情報入力]
    B --> C[セクション追加]
    C --> D[質問追加]
    D --> E[質問タイプ選択]
    
    E --> F[単一選択]
    E --> G[複数選択]
    E --> H[テキスト入力]
    E --> I[数値入力]
    E --> J[日付入力]
    
    F --> K[選択肢設定]
    G --> K
    H --> L[入力制限設定]
    I --> M[数値範囲設定]
    J --> N[日付範囲設定]
    
    K --> O[ロジック設定]
    L --> O
    M --> O
    N --> O
    
    O --> P{追加質問?}
    P -->|はい| D
    P -->|いいえ| Q[プレビュー]
    
    Q --> R{修正必要?}
    R -->|はい| C
    R -->|いいえ| S[レビュー]
    
    S --> T{承認?}
    T -->|否認| C
    T -->|承認| U[公開]
```

## 認証・セッション管理フロー

```mermaid
graph TD
    A[ページアクセス] --> B{セッション有効?}
    B -->|無効| C[ログイン画面]
    B -->|有効| D[認証済みページ]
    
    C --> E[ユーザー認証]
    E --> F{認証成功?}
    F -->|失敗| G[エラーメッセージ]
    F -->|成功| H[セッション作成]
    
    G --> C
    H --> I[リダイレクト]
    I --> D
    
    D --> J{セッション期限切れ?}
    J -->|はい| C
    J -->|いいえ| K[継続利用]
```

## アンケート編集モードフロー

```mermaid
graph TD
    A[編集画面] --> B[モード選択]
    B --> C[編集モード]
    B --> D[プレビューモード]
    B --> E[チェックモード]
    
    C --> F[ドラッグ&ドロップ編集]
    F --> G[質問追加/削除]
    F --> H[セクション追加/削除]
    F --> I[順序変更]
    
    G --> J[リアルタイム保存]
    H --> J
    I --> J
    
    D --> K[プレビュー表示]
    K --> L{修正必要?}
    L -->|はい| C
    L -->|いいえ| M[レビューへ]
    
    E --> N[ロジックチェック]
    N --> O[エラー検出]
    O --> P{エラー有り?}
    P -->|はい| Q[エラー修正]
    P -->|いいえ| R[チェック完了]
    
    Q --> C
    R --> M
```

## レビュープロセスフロー

```mermaid
graph TD
    A[レビュー開始] --> B[レビューモード選択]
    B --> C[ユーザーレビュー]
    B --> D[AIレビュー]
    B --> E[ロジックレビュー]
    
    C --> F[コメント追加]
    F --> G[修正指示]
    G --> H[編集画面へ戻る]
    
    D --> I[AI分析]
    I --> J[改善提案]
    J --> K[提案適用]
    K --> L{承認?}
    L -->|はい| M[自動適用]
    L -->|いいえ| N[手動修正]
    
    E --> O[ロジック検証]
    O --> P[エラー報告]
    P --> Q[修正要求]
    Q --> H
    
    M --> R[レビュー完了]
    N --> R
    H --> S[修正完了]
    S --> T[再レビュー]
    T --> B
```

## 公開・回答フロー

```mermaid
graph TD
    A[公開準備] --> B[URL生成]
    B --> C[パスワード生成]
    C --> D[公開設定]
    D --> E[公開実行]
    
    E --> F[回答者アクセス]
    F --> G[パスワード認証]
    G --> H{認証成功?}
    H -->|失敗| I[エラーメッセージ]
    H -->|成功| J[アンケート表示]
    
    I --> F
    J --> K[回答入力]
    K --> L[回答保存]
    L --> M[完了画面]
    
    M --> N[結果集計]
    N --> O[管理者確認]
    O --> P[結果分析]
```

## エラーハンドリングフロー

```mermaid
graph TD
    A[エラー発生] --> B[エラータイプ判定]
    B --> C[認証エラー]
    B --> D[バリデーションエラー]
    B --> E[システムエラー]
    B --> F[ネットワークエラー]
    
    C --> G[ログイン画面へリダイレクト]
    D --> H[エラーメッセージ表示]
    E --> I[システムエラー画面]
    F --> J[ネットワークエラー画面]
    
    G --> K[再認証]
    H --> L[入力修正]
    I --> M[システム復旧待機]
    J --> N[再接続試行]
    
    K --> O{認証成功?}
    O -->|成功| P[元画面へ復帰]
    O -->|失敗| G
    
    L --> Q{修正完了?}
    Q -->|完了| P
    Q -->|未完了| H
    
    M --> R{復旧完了?}
    R -->|完了| P
    R -->|未完了| M
    
    N --> S{接続成功?}
    S -->|成功| P
    S -->|失敗| J
```

## データフロー

```mermaid
graph LR
    A[フロントエンド] --> B[API Layer]
    B --> C[認証サービス]
    B --> D[アンケートサービス]
    B --> E[回答サービス]
    
    C --> F[認証DB]
    D --> G[アンケートDB]
    E --> H[回答DB]
    
    F --> I[セッション管理]
    G --> J[アンケート管理]
    H --> K[回答集計]
    
    I --> L[セキュリティ]
    J --> M[データ整合性]
    K --> N[分析・レポート]
```

## セキュリティフロー

```mermaid
graph TD
    A[リクエスト] --> B[認証チェック]
    B --> C{認証済み?}
    C -->|未認証| D[401 Unauthorized]
    C -->|認証済み| E[権限チェック]
    
    E --> F{権限あり?}
    F -->|権限なし| G[403 Forbidden]
    F -->|権限あり| H[入力検証]
    
    H --> I{入力妥当?}
    I -->|不正| J[400 Bad Request]
    I -->|妥当| K[処理実行]
    
    K --> L[ログ記録]
    L --> M[レスポンス]
    
    D --> N[ログイン画面]
    G --> O[エラー画面]
    J --> P[エラーメッセージ]
    M --> Q[成功レスポンス]
```

## パフォーマンス最適化フロー

```mermaid
graph TD
    A[ページアクセス] --> B[キャッシュチェック]
    B --> C{キャッシュヒット?}
    C -->|ヒット| D[キャッシュから取得]
    C -->|ミス| E[データベース取得]
    
    E --> F[データ処理]
    F --> G[キャッシュ保存]
    G --> H[レスポンス生成]
    
    D --> I[レスポンス送信]
    H --> I
    
    I --> J[パフォーマンス監視]
    J --> K{閾値超過?}
    K -->|超過| L[最適化実行]
    K -->|未超過| M[継続監視]
    
    L --> N[キャッシュ更新]
    N --> M
```

---

## 主要機能一覧

### 認証・セッション管理
- ユーザー認証
- セッション管理
- 権限制御
- セキュリティ

### アンケート作成・編集
- ドラッグ&ドロップ編集
- リアルタイムプレビュー
- ロジックチェック
- バリデーション

### レビュー・承認
- ユーザーレビュー
- AIレビュー
- コメント機能
- 承認ワークフロー

### 公開・回答
- URL生成
- パスワード保護
- 回答収集
- 結果集計

### エラー処理
- エラーハンドリング
- ログ記録
- 復旧処理
- ユーザー通知 